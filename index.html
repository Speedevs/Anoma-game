<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mage Puzzle Game</title>
  <style>
    body {
      background: linear-gradient(135deg, white 50%, red 50%);
      color: #111;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      padding: 20px;
    }

    .game-container {
      text-align: center;
    }

    h1 {
      color: red;
      margin: 20px 0;
      text-shadow: 1px 1px 2px white;
    }

    #controls {
      margin: 10px;
    }

    select, button {
      padding: 8px;
      margin: 5px;
      font-size: 14px;
      border-radius: 6px;
      border: 2px solid red;
      cursor: pointer;
    }

    #gridSize, #difficulty, #imageSelect {
      background: white;
      color: red;
    }

    #reset {
      background: red;
      color: white;
      font-weight: bold;
    }
    #reset:hover {
      background: darkred;
    }

    #stats {
      margin: 10px;
      font-size: 18px;
      font-weight: bold;
      color: black;
    }

    #puzzle {
      display: grid;
      margin: 20px auto;
      border: 4px solid red;
      background: white;
    }

    .tile {
      cursor: pointer;
      border: 1px solid red;
      background-size: cover;
      transition: all 0.2s;
    }

    .tile:hover {
      border: 2px solid yellow;
      box-shadow: 0 0 10px red;
    }

    .empty {
      background: white !important;
      cursor: default;
    }

    #message {
      font-size: 22px;
      margin-top: 15px;
      font-weight: bold;
    }

    @keyframes bounceFlash {
      0%, 100% { transform: scale(1); color: green; }
      25% { transform: scale(1.2); color: limegreen; }
      50% { transform: scale(0.9); color: darkgreen; }
      75% { transform: scale(1.1); color: greenyellow; }
    }

    .winMessage {
      animation: bounceFlash 1s infinite;
      font-size: 26px;
    }

    .guide {
      text-align: center;
    }

    .guide img {
      border: 4px solid red;
      border-radius: 10px;
    }

    .guide p {
      font-size: 20px;
      font-weight: bold;
      color: red;
      margin-top: 10px;
    }

    /* Leaderboard Styles */
    #leaderboard {
      margin-top: 20px;
      padding: 10px;
      border: 3px solid red;
      border-radius: 10px;
      background: white;
      color: black;
      font-size: 16px;
      max-width: 400px;
    }

    #leaderboard h2 {
      margin-bottom: 10px;
      color: red;
    }

    #leaderboard ol {
      padding-left: 20px;
      text-align: left;
    }

    #leaderboard li {
      margin: 4px 0;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>Mage Puzzle Game</h1>

    <div id="controls">
      <label for="gridSize">Grid Size: </label>
      <select id="gridSize">
        <option value="3">3x3 (Easy)</option>
        <option value="4">4x4 (Medium)</option>
        <option value="5">5x5 (Hard)</option>
      </select>

      <label for="difficulty">Shuffle Difficulty: </label>
      <select id="difficulty">
        <option value="10">Very Easy</option>
        <option value="20">Easy</option>
        <option value="50">Medium</option>
        <option value="100">Hard</option>
        <option value="200">Extreme</option>
      </select>

      <label for="imageSelect">Image: </label>
      <select id="imageSelect">
        <option value="mage.png">Mage 1</option>
        <option value="mage2.png">Mage 2</option>
        <option value="mage3.png">Mage 3</option>
      </select>

      <button id="reset">Shuffle</button>
    </div>

    <div id="stats">
      ‚è± Time: <span id="timer">0</span>s | üéÆ Moves: <span id="moves">0</span>
    </div>

    <div id="puzzle"></div>
    <div id="message"></div>

    <div id="leaderboard">
      <h2>üèÜ Leaderboard</h2>
      <ol id="leaderboardList"></ol>
    </div>
  </div>

  <div class="guide">
    <img id="guideImg" src="mage.png" alt="Mage Puzzle Guide">
    <p>‚ö° Finish the Puzzle, Mage! ‚ö°</p>
  </div>

  <script>
    const puzzle = document.getElementById("puzzle");
    const message = document.getElementById("message");
    const gridSizeSelect = document.getElementById("gridSize");
    const difficultySelect = document.getElementById("difficulty");
    const imageSelect = document.getElementById("imageSelect");
    const timerDisplay = document.getElementById("timer");
    const movesDisplay = document.getElementById("moves");
    const guideImg = document.getElementById("guideImg");
    const leaderboardList = document.getElementById("leaderboardList");

    let size = 3;
    let tiles = [];
    let emptyIndex;
    let timer = 0;
    let moves = 0;
    let timerInterval;
    let currentImage = "mage.png";

    function createTiles() {
      tiles = [];
      puzzle.innerHTML = "";
      message.textContent = "";
      message.classList.remove("winMessage");
      timer = 0;
      moves = 0;
      updateStats();
      clearInterval(timerInterval);

      size = parseInt(gridSizeSelect.value);
      currentImage = imageSelect.value;
      guideImg.src = currentImage;

      puzzle.style.gridTemplateColumns = `repeat(${size}, 100px)`;
      puzzle.style.gridTemplateRows = `repeat(${size}, 100px)`;

      guideImg.style.width = `${size * 100}px`;
      guideImg.style.height = `${size * 100}px`;

      let positions = [];
      for (let row = 0; row < size; row++) {
        for (let col = 0; col < size; col++) {
          if (row === size - 1 && col === size - 1) {
            positions.push("empty");
          } else {
            positions.push({ row, col });
          }
        }
      }

      positions.forEach((pos, i) => {
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.style.width = "100px";
        tile.style.height = "100px";

        if (pos === "empty") {
          tile.classList.add("empty");
          emptyIndex = i;
        } else {
          tile.style.backgroundImage = `url("${currentImage}")`;
          tile.style.backgroundSize = `${size * 100}px ${size * 100}px`;
          tile.style.backgroundPosition = `-${pos.col * 100}px -${pos.row * 100}px`;
          tile.dataset.row = pos.row;
          tile.dataset.col = pos.col;
        }
        tile.dataset.index = i;
        tile.addEventListener("click", () => moveTile(i));
        tiles.push(tile);
        puzzle.appendChild(tile);
      });

      shufflePuzzle();
      startTimer();
    }

    function moveTile(i) {
      const validMoves = getValidMoves(emptyIndex);
      if (validMoves.includes(i)) {
        [tiles[i], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[i]];
        emptyIndex = i;
        render();
        moves++;
        updateStats();
        checkWin();
      }
    }

    function getValidMoves(index) {
      const row = Math.floor(index / size);
      const col = index % size;
      const moves = [];
      if (row > 0) moves.push(index - size);
      if (row < size - 1) moves.push(index + size);
      if (col > 0) moves.push(index - 1);
      if (col < size - 1) moves.push(index + 1);
      return moves;
    }

    function render() {
      puzzle.innerHTML = "";
      tiles.forEach(tile => puzzle.appendChild(tile));
    }

    function shufflePuzzle() {
      const difficulty = parseInt(difficultySelect.value);
      for (let i = 0; i < difficulty; i++) {
        const moves = getValidMoves(emptyIndex);
        const move = moves[Math.floor(Math.random() * moves.length)];
        [tiles[move], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[move]];
        emptyIndex = move;
      }
      render();
    }

    function checkWin() {
      for (let i = 0; i < tiles.length; i++) {
        const tile = tiles[i];
        if (tile.classList.contains("empty")) continue;
        const correctRow = tile.dataset.row;
        const correctCol = tile.dataset.col;
        const currentRow = Math.floor(i / size);
        const currentCol = i % size;
        if (correctRow != currentRow || correctCol != currentCol) {
          return false;
        }
      }
      clearInterval(timerInterval);
      message.classList.add("winMessage");
      message.innerHTML = `‚ú® You distinguished Mage from Anoma! You finally won ‚ú®<br>‚è± ${timer}s | üéÆ ${moves} moves`;

      saveToLeaderboard(timer, moves);
      return true;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timer++;
        updateStats();
      }, 1000);
    }

    function updateStats() {
      timerDisplay.textContent = timer;
      movesDisplay.textContent = moves;
    }

    // Leaderboard functions
    function saveToLeaderboard(time, moves) {
      let leaderboard = JSON.parse(localStorage.getItem("mageLeaderboard")) || [];
      const record = {
        time,
        moves,
        grid: `${size}x${size}`,
        difficulty: difficultySelect.options[difficultySelect.selectedIndex].text,
        image: imageSelect.options[imageSelect.selectedIndex].text,
        date: new Date().toLocaleString()
      };

      leaderboard.push(record);

      leaderboard.sort((a, b) => a.time - b.time || a.moves - b.moves);
      leaderboard = leaderboard.slice(0, 5);

      localStorage.setItem("mageLeaderboard", JSON.stringify(leaderboard));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      let leaderboard = JSON.parse(localStorage.getItem("mageLeaderboard")) || [];
      leaderboardList.innerHTML = "";
      leaderboard.forEach((entry, i) => {
        const li = document.createElement("li");
        li.textContent = `${i+1}. ${entry.grid}, ${entry.difficulty}, ${entry.image} ‚Üí ‚è± ${entry.time}s, üéÆ ${entry.moves} moves`;
        leaderboardList.appendChild(li);
      });
    }

    document.addEventListener("keydown", e => {
      let targetIndex = emptyIndex;
      if (e.key === "ArrowUp" && emptyIndex + size < size * size) {
        targetIndex = emptyIndex + size;
      }
      if (e.key === "ArrowDown" && emptyIndex - size >= 0) {
        targetIndex = emptyIndex - size;
      }
      if (e.key === "ArrowLeft" && (emptyIndex % size) < size - 1) {
        targetIndex = emptyIndex + 1;
      }
      if (e.key === "ArrowRight" && (emptyIndex % size) > 0) {
        targetIndex = emptyIndex - 1;
      }
      if (targetIndex !== emptyIndex) {
        moveTile(targetIndex);
      }
    });

    // Swipe controls
    let touchStartX, touchStartY;
    puzzle.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
    });

    puzzle.addEventListener("touchend", e => {
      const touch = e.changedTouches[0];
      let dx = touch.clientX - touchStartX;
      let dy = touch.clientY - touchStartY;

      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 30) document.dispatchEvent(new KeyboardEvent("keydown", { key: "ArrowRight" }));
        if (dx < -30) document.dispatchEvent(new KeyboardEvent("keydown", { key: "ArrowLeft" }));
      } else {
        if (dy > 30) document.dispatchEvent(new KeyboardEvent("keydown", { key: "ArrowDown" }));
        if (dy < -30) document.dispatchEvent(new KeyboardEvent("keydown", { key: "ArrowUp" }));
      }
    });

    document.getElementById("reset").addEventListener("click", createTiles);
    imageSelect.addEventListener("change", createTiles);

    // Start game
    createTiles();
    renderLeaderboard();
  </script>
</body>
</html>
